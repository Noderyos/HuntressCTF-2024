import re

text = open("stage0-cleaned.bat").read()

reg = re.findall(r"set /a .*=(\d+)\n.*\nset (\w+).*", text)

rep = {}
for r in reg: rep[r[1]] = chr(int(r[0]))

buf = ""
temp = ""
is_var = False

for c in text:
	if is_var:
		if c == "%":
			is_var = False
			if temp in rep.keys():
				buf += rep[temp]
			else:
				buf += "%" + temp + "%"
			temp = ""
		else:
			temp += c
	else:
		if c == "%":
			is_var = True
		else:
			buf += c



open("stage0-cleaned.bat", "w").write(buf)