# X-Ray

## Solver : `Noderyos`

At first time, the file x-ray seems juste random data (file says `data`), but we know he has been "quarantined", after some research, I found [this article](https://reversingfun.com/posts/how-to-extract-quarantine-files-from-windows-defender/) that explain how Windows Defender quarantine files, I stole the key and `rc4_decrypt` function from his code to decode the file and the start to remove useless bytes in `unpack.py`, and now, file says `PE32 executable (DLL) (console) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections`, after exploring the code in dnSpy, I found this function in `StageTwo.cs` :
```cs
private static byte[] otp(byte[] data, byte[] key){
	byte[] array = new byte[data.Length];
	for (int i = 0; i < data.Length; i++){
		array[i] = data[i] ^ key[i % key.Length];
	}
	return array;
}

private static byte[] load(string hex){
	int length = hex.Length;
	byte[] array = new byte[length / 2];
	for (int i = 0; i < length; i += 2){
		array[i / 2] = Convert.ToByte(hex.Substring(i, 2), 16);
	}
	return array;
}

public static void Main(string[] args){
	// ...
	byte[] array = StageTwo.load("15b279d8c0fdbd7d4a8eea255876a0fd189f4fafd4f4124dafae47cb20a447308e3f77995d3c");
	byte[] array2 = StageTwo.load("73de18bfbb99db4f7cbed3156d40959e7aac7d96b29071759c9b70fb18947000be5d41ab6c41");
	byte[] array3 = StageTwo.otp(array, array2);
	Encoding.UTF8.GetString(array3);
}
```

So I replicated this code in python in `stage2.py` then ran the file, giving me the flag.

## Flag : `flag{df26090565cb329fdc8357080700b621}`
